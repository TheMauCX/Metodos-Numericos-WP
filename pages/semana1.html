<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>An√°lisis de Errores - M√©todos Num√©ricos</title>
    <link rel="stylesheet" href="../assets/css/styles.css">
</head>
<body>
    <a href="../index.html" class="back-button">‚Üê Volver al Inicio</a>
    
    <div class="container">
        <div class="page-container">
            <h1 class="page-title">An√°lisis de Errores</h1>
            <p class="subtitle">C√°lculo de errores y sistemas de punto flotante</p>

            <!-- Secci√≥n de C√°lculo de Errores -->
            <div class="form-section">
                <h2 class="section-title">C√°lculo de Errores</h2>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="trueValue">Valor verdadero:</label>
                        <input type="number" step="any" id="trueValue" placeholder="Ingrese el valor verdadero">
                    </div>
                    
                    <div class="form-group">
                        <label for="approxValue">Valor aproximado:</label>
                        <input type="number" step="any" id="approxValue" placeholder="Ingrese el valor aproximado">
                    </div>
                </div>

                <button class="btn btn-primary btn-block" onclick="calculateErrors()">Calcular Errores</button>
                
                <div id="errorResults" class="results-section" style="display: none;">
                    <h3 class="section-title">Resultados de Errores</h3>
                    <div id="errorResultsContent"></div>
                </div>
            </div>

            <!-- Secci√≥n de Sistema de Punto Flotante -->
            <div class="form-section">
                <h2 class="section-title">Sistema de Punto Flotante</h2>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="base">Base del sistema (Œ≤):</label>
                        <input type="number" id="base" min="2" value="2" placeholder="Base (‚â•2)">
                        <div class="input-help">Base num√©rica (debe ser ‚â• 2)</div>
                    </div>
                    
                    <div class="form-group">
                        <label for="digits">N√∫mero de d√≠gitos de la mantisa (t):</label>
                        <input type="number" id="digits" min="1" value="3" placeholder="D√≠gitos (‚â•1)">
                        <div class="input-help">Cantidad de d√≠gitos significativos</div>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="minExp">Menor exponente permitido (L):</label>
                        <input type="number" id="minExp" value="-3" placeholder="Exponente m√≠nimo">
                    </div>
                    
                    <div class="form-group">
                        <label for="maxExp">Mayor exponente permitido (U):</label>
                        <input type="number" id="maxExp" value="3" placeholder="Exponente m√°ximo">
                    </div>
                </div>

                <button class="btn btn-primary btn-block" onclick="analyzeFloatingPoint()">Analizar Sistema</button>
                
                <div id="floatingPointResults" class="results-section" style="display: none;">
                    <h3 class="section-title">Resultados del Sistema</h3>
                    <div id="floatingPointResultsContent"></div>
                </div>
            </div>
        </div>
    </div>

    <script src="../assets/js/common.js"></script>
    <script>
        function calculateErrors() {
            const trueValue = parseFloat(document.getElementById('trueValue').value);
            const approxValue = parseFloat(document.getElementById('approxValue').value);

            // Validaciones
            if (isNaN(trueValue) || isNaN(approxValue)) {
                UI.showAlert("Por favor ingrese valores num√©ricos v√°lidos.", "error");
                UI.hideResults("errorResults");
                return;
            }

            if (trueValue === 0) {
                UI.showAlert("El valor verdadero no puede ser cero (causar√≠a divisi√≥n por cero).", "error");
                UI.hideResults("errorResults");
                return;
            }

            try {
                const absoluteError = Math.abs(trueValue - approxValue);
                const relativeError = absoluteError / Math.abs(trueValue);
                const percentageError = relativeError * 100;

                const html = `
                    <div class="result-summary">
                        <h3>üìä Resultados del C√°lculo de Errores</h3>
                        <p><strong>Valor verdadero:</strong> ${MathUtils.formatNumber(trueValue)}</p>
                        <p><strong>Valor aproximado:</strong> ${MathUtils.formatNumber(approxValue)}</p>
                        <p><strong>Error absoluto:</strong> ${absoluteError.toExponential(8)}</p>
                        <p><strong>Error relativo:</strong> ${relativeError.toExponential(8)}</p>
                        <p><strong>Porcentaje de error relativo:</strong> ${percentageError.toExponential(8)}%</p>
                    </div>
                `;

                document.getElementById("errorResultsContent").innerHTML = html;
                document.getElementById("errorResults").style.display = "block";
                
                UI.showAlert("C√°lculo de errores completado exitosamente.", "success");

            } catch (e) {
                UI.showAlert("Error en el c√°lculo: " + e.message, "error");
                UI.hideResults("errorResults");
            }
        }

        function analyzeFloatingPoint() {
            const base = parseInt(document.getElementById('base').value);
            const digits = parseInt(document.getElementById('digits').value);
            const minExp = parseInt(document.getElementById('minExp').value);
            const maxExp = parseInt(document.getElementById('maxExp').value);

            // Validaciones
            if (base < 2 || isNaN(base)) {
                UI.showAlert("La base debe ser un n√∫mero ‚â• 2.", "error");
                UI.hideResults("floatingPointResults");
                return;
            }

            if (digits < 1 || isNaN(digits)) {
                UI.showAlert("El n√∫mero de d√≠gitos debe ser ‚â• 1.", "error");
                UI.hideResults("floatingPointResults");
                return;
            }

            if (isNaN(minExp) || isNaN(maxExp) || minExp >= maxExp) {
                UI.showAlert("Los exponentes deben ser v√°lidos y L debe ser menor que U.", "error");
                UI.hideResults("floatingPointResults");
                return;
            }

            try {
                // Calcular el n√∫mero m√°s grande 
                const largestNumber = (1 - Math.pow(base, -digits)) * Math.pow(base, maxExp);

                // Calcular el n√∫mero m√°s peque√±o normalizado 
                const smallestNormalized = Math.pow(base, minExp - 1);

                // Calcular el n√∫mero m√°s peque√±o en general (considerando subnormales) 
                const smallestDenormalized = Math.pow(base, minExp - digits);

                // Calcular la cantidad de elementos en el sistema 
                const positiveNumbers = (base - 1) * Math.pow(base, digits - 1) * (maxExp - minExp + 1);
                const totalNumbers = 2 * positiveNumbers + 1; // +1 para el cero 

                const html = `
                    <div class="result-summary">
                        <h3>üìä Resultados del Sistema de Punto Flotante</h3>
                        <p><strong>Par√°metros:</strong> Œ≤ = ${base}, t = ${digits}, L = ${minExp}, U = ${maxExp}</p>
                        <p><strong>Forma normalizada:</strong> ¬±0.d‚ÇÅd‚ÇÇ...d‚Çú √ó Œ≤·µâ donde d‚ÇÅ‚â†0 y L ‚â§ e ‚â§ U</p>
                        <p><strong>N√∫mero de elementos en el sistema:</strong> ${totalNumbers} (incluyendo ¬±0)</p>
                        <p><strong>N√∫mero m√°s grande representable:</strong> ${largestNumber.toExponential(digits)}</p>
                        <p><strong>N√∫mero m√°s peque√±o normalizado:</strong> ${smallestNormalized.toExponential(digits)}</p>
                        <p><strong>N√∫mero m√°s peque√±o en general:</strong> ${smallestDenormalized.toExponential(digits)}</p>
                    </div>
                    
                    <div class="result-card">
                        <h4>‚ö° Consideraciones importantes:</h4>
                        <p><strong>OVERFLOW:</strong> Cualquier n√∫mero > ${largestNumber.toExponential(digits)} se considera +‚àû</p>
                        <p><strong>UNDERFLOW:</strong> N√∫meros entre ¬±0 y ¬±${smallestNormalized.toExponential(digits)} pueden perder precisi√≥n</p>
                        <p>N√∫meros con valor absoluto < ${smallestDenormalized.toExponential(digits)} se consideran 0</p>
                    </div>
                `;

                document.getElementById("floatingPointResultsContent").innerHTML = html;
                document.getElementById("floatingPointResults").style.display = "block";
                
                UI.showAlert("An√°lisis del sistema de punto flotante completado.", "success");

            } catch (e) {
                UI.showAlert("Error en el an√°lisis: " + e.message, "error");
                UI.hideResults("floatingPointResults");
            }
        }

        // Configuraci√≥n de validaci√≥n en tiempo real
        document.addEventListener('DOMContentLoaded', function() {
            FormValidation.setupNumericValidation('trueValue', { required: true });
            FormValidation.setupNumericValidation('approxValue', { required: true });
            FormValidation.setupNumericValidation('base', { min: 2, required: true });
            FormValidation.setupNumericValidation('digits', { min: 1, required: true });
            FormValidation.setupNumericValidation('minExp', { required: true });
            FormValidation.setupNumericValidation('maxExp', { required: true });
        });
    </script>
</body>
</html>